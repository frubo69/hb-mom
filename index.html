<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ASCII-–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ (–º–∏–Ω–∏-–º—É–ª—å—Ç—Ñ–∏–ª—å–º ‚Üí –ø–æ—Ä—Ç—Ä–µ—Ç ‚Üí —Å–µ—Ä–¥—Ü–µ)</title>
<style>
  :root { --bg:#0b0e14; --fg:#e5e7eb; --muted:#94a3b8; --accent:#60a5fa; }
  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background: var(--bg); color: var(--fg);
    display: grid; min-height: 100svh; place-items: center;
  }
  .card {
    width: min(1200px, 96vw); padding: 20px; border-radius: 14px;
    background: #111827; box-shadow: 0 10px 40px rgba(0,0,0,.35);
    border: 1px solid #1f2937;
  }
  h1 { margin: 0 0 6px; font-size: 18px; font-weight: 600; letter-spacing: .3px; }
  p.hint { margin: 0 0 12px; color: var(--muted); font-size: 13px; }
  .controls { display: flex; flex-wrap: wrap; gap: 12px 18px; align-items: center; margin-bottom: 12px; }
  .control { display: grid; gap: 6px; font-size: 12px; color: var(--muted); }
  .control input[type="range"] { width: 200px; }
  .btn {
    appearance: none; border: 1px solid #334155; background: #0f172a; color: var(--fg);
    padding: 9px 12px; border-radius: 10px; font-size: 13px; cursor: pointer;
    touch-action: manipulation; /* –õ—É—á—à–∏–π –æ—Ç–∫–ª–∏–∫ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
  }
  .btn:hover { border-color: var(--accent); }
  .btn:active { background: #1e293b; }
  .drop {
    border: 2px dashed #334155; border-radius: 12px; padding: 16px;
    display: grid; place-items: center; text-align: center; color: var(--muted); margin-bottom: 12px;
  }
  .drop.drag { border-color: var(--accent); color: var(--fg); }
  pre#out {
    margin: 0; white-space: pre; overflow: auto; max-height: 62svh;
    font-size: 9.8px; line-height: 9.8px; letter-spacing: .35px;
    background: #0b0e14; border: 1px solid #1f2937; border-radius: 12px; padding: 12px;
    transition: opacity .8s ease;
  }
  @media (max-width: 768px) {
    pre#out {
      font-size: 6.5px; line-height: 6.5px; letter-spacing: 0.2px;
      padding: 8px; max-height: 70svh;
    }
    .card {
      padding: 12px;
    }
    h1 {
      font-size: 16px;
    }
    .hint {
      font-size: 12px;
    }
    #caption {
      font-size: 14px;
    }
    .btn {
      padding: 12px 16px;
      font-size: 14px;
      min-width: 120px;
    }
    .controls {
      justify-content: center;
    }
  }
  #caption {
    margin-top: 10px; min-height: 1.4em; font-size: 16px; color: var(--fg); letter-spacing: .3px;
    opacity: 0; transition: opacity .6s ease;
  }
  .show { opacity: 1 !important; }
  .caret { display:inline-block; width: .6ch; }
  @keyframes blink { 0%,49%{opacity:1} 50%,100%{opacity:0} }
  .caret::after { content: "‚ñå"; animation: blink 1s steps(1) infinite; }
  .row { display: flex; gap: 10px; flex-wrap: wrap; }
  .spacer { flex: 1 1 auto; }
  .note { font-size: 12px; color: var(--muted); }
</style>
</head>
<body>
  <div class="card">
    <h1>–ú–∞–º–∞, —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è!</h1>
    <p class="hint">–ù–∞–∂–º–∏ ¬´–ü—Ä–æ–∏–≥—Ä–∞—Ç—å¬ª —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ. –ó–≤—É–∫ –ø–æ –∂–µ–ª–∞–Ω–∏—é.</p>

    <div class="controls">
      <label class="control">–ó–≤—É–∫ (–º–µ–ª–æ–¥–∏—è)
        <input id="sound" type="checkbox" checked />
      </label>
      <div class="spacer"></div>
      <div class="row">
        <button class="btn" id="play">‚ñ∂ –ü—Ä–æ–∏–≥—Ä–∞—Ç—å</button>
        <button class="btn" id="replay">üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
      </div>
    </div>

    <pre id="out">¬´–Ø –ª—é–±–ª—é —Ç–µ–±—è, —Å –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è!¬ª</pre>
    <div id="caption"></div>

    <p class="note">–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Å–∫—É—á–∞—é!</p>
  </div>

<script>
(() => {
  // –£–∑–ª—ã
  const $ = id => document.getElementById(id);
  const out = $('out'), caption = $('caption'), soundEl = $('sound');

  // –°–ª—É–∂–µ–±–Ω—ã–µ
  function clamp(v,a,b){ return Math.min(b, Math.max(a, v)); }
  const wait = ms => new Promise(r => setTimeout(r, ms));

  // –†–∞–∑–º–µ—Ä—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞)
  const isMobile = window.innerWidth <= 768;
  const rows = isMobile ? 45 : 50;
  const cols = isMobile ? 100 : 120;

  // ---------- –ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–π –º—É–ª—å—Ç–∏–∫: —Å—Ü–µ–Ω—ã, –∫–∞–º–µ—Ä–∞, —á–∞—Å—Ç–∏—Ü—ã ----------
  function animateIntro(durationMs = 8000, fps = isMobile ? 24 : 30) {
    const W = cols || 120, H = rows || 60;
    const start = performance.now();
    let tPrev = start;

    // === –ß–ê–°–¢–ò–¶–´ ===
    const particles = []; // {x, y, vx, vy, char, life, maxLife, trail, color}
    const sparks = [];    // —Ä–æ–π –∏—Å–∫—Ä
    const rain = [];      // –¥–æ–∂–¥—å –∏–∑ —É–≥–∞—Å–∞—é—â–∏—Ö —á–∞—Å—Ç–∏—Ü
    const letters = [];   // —á–∞—Å—Ç–∏—Ü—ã –¥–ª—è –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
    const dubaiText = []; // —Ç–µ–∫—Å—Ç –æ –ø–æ–¥–∞—Ä–∫–µ –≤ –î—É–±–∞–µ

    // –¢–∏–ø—ã —Å–∞–ª—é—Ç–æ–≤
    function createBurst(x, y, type = 'radial') {
      const particleMultiplier = isMobile ? 0.75 : 1; // –ù–µ–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ —á–∞—Å—Ç–∏—Ü –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
      const count = Math.floor((type === 'fountain' ? 60 : type === 'spiral' ? 80 : 50) * particleMultiplier);
      const speed = type === 'fountain' ? 1.2 : type === 'mega' ? 2.5 : 1.8;
      
      for (let i = 0; i < count; i++) {
        const angle = type === 'spiral' 
          ? (i / count) * Math.PI * 6 + Math.random() * 0.3
          : Math.random() * Math.PI * 2;
        
        const r = type === 'fountain' ? Math.random() * 0.7 + 0.3 : 1;
        const vx = Math.cos(angle) * speed * r * (0.7 + Math.random() * 0.6);
        const vy = type === 'fountain' 
          ? -Math.abs(Math.sin(angle)) * speed * r - Math.random() * 2
          : Math.sin(angle) * speed * r * (0.7 + Math.random() * 0.6);
        
        const chars = type === 'mega' ? ['‚óè','‚óâ','‚óã','‚óé','‚ú¶','‚úß','‚òÖ','‚òÜ'] : ['*','+','¬∑','‚àô','‚Ä¢','√ó','‚ú¶','‚úß'];
        particles.push({
          x, y, vx, vy,
          char: chars[Math.floor(Math.random() * chars.length)],
          life: 1,
          maxLife: type === 'fountain' ? 1.4 + Math.random() * 0.8 : 1.2 + Math.random() * 0.6,
          trail: type === 'mega' ? 4 : 2,
          gravity: type === 'fountain' ? 0.15 : 0.08
        });
      }
    }

    // –†–æ–π –∏—Å–∫—Ä (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–≤–∏–∂—É—â–∏–µ—Å—è)
    function addSparks(count = 40) {
      for (let i = 0; i < count; i++) {
        sparks.push({
          x: Math.random() * W,
          y: Math.random() * H,
          vx: (Math.random() - 0.5) * 3,
          vy: (Math.random() - 0.5) * 2,
          char: ['¬∑','‚àô','Àô','‚Ä¢'][Math.floor(Math.random() * 4)],
          layer: Math.random() // –¥–ª—è –ø–∞—Ä–∞–ª–ª–∞–∫—Å–∞
        });
      }
    }

    // –î–æ–∂–¥—å –∏–∑ —á–∞—Å—Ç–∏—Ü
    function addRain(count = 30) {
      for (let i = 0; i < count; i++) {
        rain.push({
          x: Math.random() * W,
          y: -Math.random() * H * 0.3,
          vy: 0.8 + Math.random() * 1.2,
          char: ['¬∑','`','Àô','\'',','][Math.floor(Math.random() * 5)],
          life: 1,
          maxLife: 1.5 + Math.random()
        });
      }
    }

    // –ù–∞–±–æ—Ä —Ç–µ–∫—Å—Ç–∞ —á–∞—Å—Ç–∏—Ü–∞–º–∏
    function createTextParticles(text, targetY) {
      const startX = Math.floor((W - text.length) / 2);
      for (let i = 0; i < text.length; i++) {
        if (text[i] === ' ') continue;
        letters.push({
          char: text[i],
          tx: startX + i, // target x
          ty: targetY,    // target y
          x: Math.random() * W,
          y: -Math.random() * H * 0.5,
          vx: 0, vy: 0,
          arrived: false
        });
      }
    }

    // –¢–µ–∫—Å—Ç –æ –ø–æ–¥–∞—Ä–∫–µ –≤ –î—É–±–∞–µ (–º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π)
    function createDubaiMessage() {
      const lines = [
        '–¢–í–û–ô –ü–û–î–ê–†–û–ö',
        '–ñ–î–Å–¢ –¢–ï–ë–Ø',
        '–í –î–£–ë–ê–ï! ‚úà'
      ];
      const startY = Math.floor(H / 2) - lines.length - 2;
      
      lines.forEach((line, lineIdx) => {
        const startX = Math.floor((W - line.length) / 2);
        for (let i = 0; i < line.length; i++) {
          if (line[i] === ' ') continue;
          dubaiText.push({
            char: line[i],
            tx: startX + i,
            ty: startY + lineIdx * 2,
            x: Math.random() * W,
            y: -Math.random() * H * 0.5,
            vx: 0, vy: 0,
            arrived: false
          });
        }
      });
    }

    // === –ö–ê–ú–ï–†–ê (–ø–∞–Ω–æ—Ä–∞–º–∞ –∏ –ø–∞—Ä–∞–ª–ª–∞–∫—Å) ===
    let cameraX = 0, cameraY = 0;
    
    // === –°–¶–ï–ù–ê–†–ò–ô ===
    // –°—Ü–µ–Ω–∞ 1 (0-2s): –†–æ–π –∏—Å–∫—Ä + —Ñ–æ–Ω—Ç–∞–Ω—ã
    // –°—Ü–µ–Ω–∞ 2 (2-4s): –°–∞–ª—é—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ + –¥–æ–∂–¥—å —á–∞—Å—Ç–∏—Ü + –∫–∞–º–µ—Ä–∞ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä—É–µ—Ç
    // –°—Ü–µ–Ω–∞ 3 (4-5.5s): –ú–µ–≥–∞-—Å–∞–ª—é—Ç + —Ç–µ–∫—Å—Ç "–° –î–ù–Å–ú –†–û–ñ–î–ï–ù–ò–Ø!"
    // –°—Ü–µ–Ω–∞ 4 (5.5-8s): –¢–µ–∫—Å—Ç –æ—á–∏—â–∞–µ—Ç—Å—è, –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –î—É–±–∞–µ + —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∞–ª—é—Ç—ã

    // –ê—É–¥–∏–æ
    let stopSound = () => {};
    if (soundEl.checked) {
      try {
        const ctxA = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctxA.createOscillator();
        const g = ctxA.createGain();
        o.type = 'triangle'; o.connect(g); g.connect(ctxA.destination);
        const now = ctxA.currentTime;
        const notes = [523,587,659,784,880,784,659,587,523,659,784,880,1047,880,784,659];
        notes.forEach((f, i) => {
          const t = now + i*0.18;
          g.gain.setValueAtTime(0.0001, t);
          g.gain.linearRampToValueAtTime(0.10, t+0.04);
          g.gain.exponentialRampToValueAtTime(0.001, t+0.16);
          o.frequency.setValueAtTime(f, t);
        });
        o.start();
        o.stop(now + Math.min(durationMs/1000, 8.5));
        stopSound = () => { try { o.stop(); ctxA.close(); } catch(e){} };
      } catch(e) { /* –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º */ }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    addSparks(isMobile ? 60 : 80); // –ù–µ–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ –∏—Å–∫—Ä –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
    let fountainSpawned = false, textSpawned = false, dubaiSpawned = false, lettersClearedForDubai = false;

    return new Promise(resolve => {
      function put(g, x, y, ch) {
        const cx = Math.floor(x - cameraX), cy = Math.floor(y - cameraY);
        if (cy>=0 && cy<g.length && cx>=0 && cx<g[0].length && ch !== ' ') {
          g[cy][cx] = ch;
        }
      }

      function frame(now) {
        const dt = Math.min((now - tPrev) / 16, 3); tPrev = now;
        const elapsed = now - start;
        const t = elapsed / durationMs; // 0..1

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–¶–ï–ù–ê–ú–ò ===
        // –°—Ü–µ–Ω–∞ 1: –§–æ–Ω—Ç–∞–Ω—ã —Å–Ω–∏–∑—É (0-0.25)
        if (t < 0.25 && !fountainSpawned) {
          fountainSpawned = true;
          createBurst(W/2, H - 5, 'fountain');
          createBurst(W/4, H - 3, 'fountain');
          createBurst(3*W/4, H - 3, 'fountain');
        }

        // –°—Ü–µ–Ω–∞ 2: –†–∞–∑–Ω—ã–µ —Å–∞–ª—é—Ç—ã (0.25-0.5)
        if (t >= 0.25 && t < 0.5) {
          if (Math.random() < 0.06) {
            createBurst(
              10 + Math.random() * (W - 20),
              5 + Math.random() * (H * 0.4),
              ['radial','spiral'][Math.floor(Math.random() * 2)]
            );
          }
          // –ö–∞–º–µ—Ä–∞ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä—É–µ—Ç –≤–ø—Ä–∞–≤–æ-–≤–ª–µ–≤–æ
          cameraX = Math.sin(t * Math.PI * 3) * 8;
        }

        // –î–æ–∂–¥—å —á–∞—Å—Ç–∏—Ü (0.3-0.7)
        if (t >= 0.3 && t < 0.7) {
          if (Math.random() < 0.15) addRain(5);
        }

        // –°—Ü–µ–Ω–∞ 3: –ú–µ–≥–∞-—Å–∞–ª—é—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ (0.5-0.65)
        if (t >= 0.5 && t < 0.65) {
          if (Math.random() < 0.08) {
            createBurst(W/2 + (Math.random()-0.5)*20, H/3, 'mega');
          }
        }

        // –¢–µ–∫—Å—Ç "–° –î–ù–Å–ú –†–û–ñ–î–ï–ù–ò–Ø!" (0.5-0.69)
        if (t >= 0.5 && t < 0.69 && !textSpawned) {
          textSpawned = true;
          createTextParticles('–°  –î–ù–Å–ú  –†–û–ñ–î–ï–ù–ò–Ø!', Math.floor(H/2));
        }

        // –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –î—É–±–∞–µ (0.69)
        if (t >= 0.69 && !lettersClearedForDubai) {
          lettersClearedForDubai = true;
          letters.length = 0; // –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç
        }

        // –°—Ü–µ–Ω–∞ 4: –°–æ–æ–±—â–µ–Ω–∏–µ –æ –î—É–±–∞–µ (0.7-1.0)
        if (t >= 0.7 && !dubaiSpawned) {
          dubaiSpawned = true;
          createDubaiMessage();
        }

        // –§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∞–ª—é—Ç—ã –≤–æ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –î—É–±–∞–µ (0.75-0.95)
        if (t >= 0.75 && t < 0.95) {
          if (Math.random() < 0.05) {
            createBurst(
              15 + Math.random() * (W - 30),
              8 + Math.random() * (H * 0.3),
              'mega'
            );
          }
        }

        // === –§–ò–ó–ò–ö–ê –ò –û–¢–†–ò–°–û–í–ö–ê ===
        const grid = Array.from({length:H}, () => Array(W).fill(' '));

        // –†–æ–π –∏—Å–∫—Ä (–ø–∞—Ä–∞–ª–ª–∞–∫—Å: –¥–∞–ª—å–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
        sparks.forEach(s => {
          const parallaxFactor = 0.3 + s.layer * 0.7;
          s.x += s.vx * dt * 0.1 * parallaxFactor;
          s.y += s.vy * dt * 0.1 * parallaxFactor;
          if (s.x < 0) s.x = W; if (s.x > W) s.x = 0;
          if (s.y < 0) s.y = H; if (s.y > H) s.y = 0;
          put(grid, s.x, s.y, s.char);
        });

        // –î–æ–∂–¥—å
        for (let i = rain.length - 1; i >= 0; i--) {
          const r = rain[i];
          r.y += r.vy * dt;
          r.life -= dt * 0.02;
          if (r.y > H || r.life <= 0) { rain.splice(i, 1); continue; }
          const alpha = Math.max(0, r.life / r.maxLife);
          if (alpha > 0.3) put(grid, r.x, r.y, r.char);
        }

        // –°–∞–ª—é—Ç—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã)
        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          p.vy += p.gravity * dt;
          p.x += p.vx * dt;
          p.y += p.vy * dt;
          p.life -= dt * 0.02;

          if (p.life <= 0) { particles.splice(i, 1); continue; }

          const alpha = p.life / p.maxLife;
          // –£–≥–∞—Å–∞–Ω–∏–µ: –º–µ–Ω—è–µ–º —Å–∏–º–≤–æ–ª
          let ch = p.char;
          if (alpha < 0.3) ch = '¬∑';
          else if (alpha < 0.5) ch = '+';
          
          put(grid, p.x, p.y, ch);
          
          // –°–ª–µ–¥ (trail)
          if (p.trail > 0 && Math.random() < 0.3) {
            put(grid, p.x - p.vx * 0.5, p.y - p.vy * 0.5, '¬∑');
          }
        }

        // –¢–µ–∫—Å—Ç –∏–∑ —á–∞—Å—Ç–∏—Ü (–ø—Ä–∏—Ç—è–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏)
        letters.forEach(l => {
          if (!l.arrived) {
            const dx = l.tx - l.x, dy = l.ty - l.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist < 1) { l.arrived = true; l.x = l.tx; l.y = l.ty; }
            else {
              const force = 0.15;
              l.vx += dx * force; l.vy += dy * force;
              l.vx *= 0.85; l.vy *= 0.85; // —Ç—Ä–µ–Ω–∏–µ
              l.x += l.vx; l.y += l.vy;
            }
          }
          put(grid, l.x, l.y, l.char);
        });

        // –¢–µ–∫—Å—Ç –æ –î—É–±–∞–µ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ letters)
        dubaiText.forEach(d => {
          if (!d.arrived) {
            const dx = d.tx - d.x, dy = d.ty - d.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist < 1) { d.arrived = true; d.x = d.tx; d.y = d.ty; }
            else {
              const force = 0.15;
              d.vx += dx * force; d.vy += dy * force;
              d.vx *= 0.85; d.vy *= 0.85;
              d.x += d.vx; d.y += d.vy;
            }
          }
          put(grid, d.x, d.y, d.char);
        });

        out.textContent = grid.map(r=>r.join('')).join('\n');

        if (elapsed < durationMs) requestAnimationFrame(frame);
        else { stopSound(); resolve(); }
      }
      requestAnimationFrame(frame);
    });
  }

  // ---------- –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ ----------
  function fadeOut(el) {
    return new Promise(res => {
      el.addEventListener('transitionend', function h(e){
        if (e.propertyName === 'opacity') { el.removeEventListener('transitionend', h); res(); }
      }, { once: true });
      void el.offsetHeight; el.style.opacity = 0;
    });
  }
  function fadeIn(el) {
    return new Promise(res => {
      el.addEventListener('transitionend', function h(e){
        if (e.propertyName === 'opacity') { el.removeEventListener('transitionend', h); res(); }
      }, { once: true });
      void el.offsetHeight; el.style.opacity = 1;
    });
  }

  // –°–µ—Ä–¥—Ü–µ
  function generateHeart(w, h) {
    const CHARS = " .'`^\",:;Il!i><~+_-?][}{1)(|\\/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$";
    const sx = 1.6, sy = 1.4;
    const lines = [];
    for (let j=0;j<h;j++){
      let line = '';
      const y = (1 - (j / (h-1)) * 2) * sy; // –∏–Ω–≤–µ—Ä—Å–∏—è Y –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
      for (let i=0;i<w;i++){
        const x = ((i / (w-1)) * 2 - 1) * sx;
        const f = Math.pow(x*x + y*y - 1, 3) - x*x*y*y*y;
        if (f <= 0) {
          const t = clamp(1 - clamp((f + 1.2)/1.2, 0, 1), 0, 1);
          const idx = Math.floor(t * (CHARS.length - 1));
          line += CHARS[CHARS.length - 1 - idx];
        } else {
          line += ' ';
        }
      }
      lines.push(line);
    }
    return lines.join('\n');
  }

  async function typewriter(element, text, speed=36) {
    element.textContent = '';
    element.classList.add('show');
    let i = 0;
    const caret = document.createElement('span');
    caret.className = 'caret'; element.appendChild(caret);
    return new Promise(resolve => {
      const timer = setInterval(() => {
        caret.before(text[i++] || '');
        if (i >= text.length) { clearInterval(timer); caret.remove(); resolve(); }
      }, speed);
    });
  }

  // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  async function playSequence() {
    caption.classList.remove('show'); caption.textContent = '';
    // 1) –ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–π –º—É–ª—å—Ç–∏–∫ 8 —Å–µ–∫ (—Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ –î—É–±–∞–µ)
    await animateIntro(8000, 30);
    await wait(500);
    // 2) –ú—É–ª—å—Ç–∏–∫ –∏—Å—á–µ–∑–∞–µ—Ç ‚Üí —Å–µ—Ä–¥—Ü–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
    await fadeOut(out);
    const heart = generateHeart(cols, rows);
    out.textContent = heart;
    await fadeIn(out);
    await wait(900);
    // 3) –ü–æ–¥–ø–∏—Å—å
    await typewriter(caption, '–Ø –ª—é–±–ª—é —Ç–µ–±—è, —Å –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è!', 36);
  }

  // –ö–Ω–æ–ø–∫–∏
  $('play').onclick = () => { out.style.opacity = 1; playSequence(); };
  $('replay').onclick = () => { out.style.opacity = 1; playSequence(); };
})();
</script>
</body>
</html>
